(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-b4e54920"],{"930f":function(e,t,l){"use strict";l("d92d")},d7fc:function(e,t,l){"use strict";l.r(t);var i=l("f7fc");const c=e=>(Object(i.pushScopeId)("data-v-4872df40"),e=e(),Object(i.popScopeId)(),e),o={class:"zy-file-select"},a={class:"zy-file-select__side"},s={class:"zy-file-select__side-menu"},r={class:"el-tree-node__label"},n=c(()=>Object(i.createElementVNode)("i",{class:"el-icon-folder icon"},null,-1)),d={key:0,class:"zy-file-select__side-msg"},u=Object(i.createTextVNode)(" 已选择 "),p=Object(i.createTextVNode)(" / "),m=Object(i.createTextVNode)(" 项 "),b={class:"zy-file-select__files"},f={class:"zy-file-select__top"},g={key:0,class:"upload"},O=Object(i.createTextVNode)("本地上传"),j={class:"tips"},h=c(()=>Object(i.createElementVNode)("i",{class:"el-icon-warning-outline"},null,-1)),y={class:"keyword"},k={class:"zy-file-select__list"},v={class:"zy-file-select__item__file"},N={class:"zy-file-select__item__upload"},_=["onClick"],V={class:"zy-file-select__item__file"},z={key:0,class:"zy-file-select__item__checkbox"},C=[c(()=>Object(i.createElementVNode)("i",{class:"el-icon-check"},null,-1))],w={key:1,class:"zy-file-select__item__select"},x=[c(()=>Object(i.createElementVNode)("i",{class:"el-icon-check"},null,-1))],E=c(()=>Object(i.createElementVNode)("div",{class:"zy-file-select__item__box"},null,-1)),P=["onClick"],B=[c(()=>Object(i.createElementVNode)("i",{class:"el-icon-view"},null,-1))],S={key:3,class:"item-file item-file-doc"},I={key:1,class:"zy-icon-file-list-fill",style:{color:"#999"}},D=["title"],L={class:"zy-file-select__pagination"},q={class:"zy-file-select__do"},T=Object(i.createTextVNode)("确 定");var U=l("365c"),$={apiObj:U.a.common.upload,menuApiObj:U.a.common.file.menu,listApiObj:U.a.common.file.list,successCode:200,maxSize:30,max:99,uploadParseData:function(e){return{id:e.data.id,fileName:e.data.fileName,url:e.data.src}},listParseData:function(e){return{rows:e.data.rows,total:e.data.total,msg:e.message,code:e.code}},request:{page:"page",pageSize:"pageSize",keyword:"keyword",menuKey:"groupId"},menuProps:{key:"id",label:"label",children:"children"},fileProps:{key:"id",fileName:"fileName",url:"url"},files:{doc:{icon:"zy-icon-file-word-2-fill",color:"#409eff"},docx:{icon:"zy-icon-file-word-2-fill",color:"#409eff"},xls:{icon:"zy-icon-file-excel-2-fill",color:"#67C23A"},xlsx:{icon:"zy-icon-file-excel-2-fill",color:"#67C23A"},ppt:{icon:"zy-icon-file-ppt-2-fill",color:"#F56C6C"},pptx:{icon:"zy-icon-file-ppt-2-fill",color:"#F56C6C"}}},A={props:{modelValue:null,hideUpload:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},max:{type:Number,default:$.max},onlyImage:{type:Boolean,default:!1},maxSize:{type:Number,default:$.maxSize}},data(){return{keyword:null,pageSize:20,total:0,currentPage:1,data:[],menu:[],menuId:"",value:this.multiple?[]:"",fileList:[],accept:this.onlyImage?"images/gif, images/jpeg, images/png":"",listLoading:!1,menuLoading:!1,dialogImgVisible:!1,listImgData:{},treeProps:$.menuProps,fileProps:$.fileProps,files:$.files}},watch:{multiple(){this.value=this.multiple?[]:"",this.$emit("update:modelValue",JSON.parse(JSON.stringify(this.value)))}},mounted(){this.getMenu(),this.getData()},methods:{async getMenu(){this.menuLoading=!0;var e=await $.menuApiObj.get();this.menu=e.data,this.menuLoading=!1},async getData(){this.listLoading=!0;var e={[$.request.menuKey]:this.menuId,[$.request.page]:this.currentPage,[$.request.pageSize]:this.pageSize,[$.request.keyword]:this.keyword};this.onlyImage&&(e.type="image");var t=await $.listApiObj.get(e),l=$.listParseData(t);this.data=l.rows,this.total=l.total,this.listLoading=!1,this.$refs.scrollbar.setScrollTop(0)},groupClick(e){this.menuId=e.id,this.currentPage=1,this.keyword=null,this.getData()},reload(){this.getData()},search(){this.currentPage=1,this.getData()},fnSelect(e){const t=e[this.fileProps.url];this.multiple?this.value.includes(t)?this.value.splice(this.value.findIndex(e=>e==t),1):this.value.push(t):this.value.includes(t)?this.value=[]:this.value=t},submit(){const e=JSON.parse(JSON.stringify(this.value));this.$emit("update:modelValue",e),this.$emit("submit",e)},uploadChange(e,t){e.tempImg=URL.createObjectURL(e.raw),this.fileList=t},uploadBefore(e){if(!(e.size/1024/1024<this.maxSize))return this.$message.warning(`上传文件大小不能超过 ${this.maxSize}MB!`),!1},uploadRequest(e){var t=$.apiObj;const l=new FormData;l.append("file",e.file),l.append([$.request.menuKey],this.menuId),t.post(l,{onUploadProgress:t=>{e.onProgress(t)}}).then(t=>{e.onSuccess(t)}).catch(t=>{e.onError(t)})},uploadProcess(e,t){t.progress=Number((e.loaded/e.total*100).toFixed(2))},uploadSuccess(e,t){this.fileList.splice(this.fileList.findIndex(e=>e.uid==t.uid),1);var l=$.uploadParseData(e);this.data.unshift({[this.fileProps.key]:l.id,[this.fileProps.fileName]:l.fileName,[this.fileProps.url]:l.url}),this.multiple||(this.value=l.url)},uploadError(e){this.$notify.error({title:"上传文件错误",message:e})},_isImg(e){const t=e.substring(e.lastIndexOf("."));return-1!=[".jpg",".jpeg",".png",".gif",".bmp"].indexOf(t)},_getExt:e=>e.substring(e.lastIndexOf(".")+1),fnPreview(e){this.dialogImgVisible=!0,this.listImgData=e}}},F=(l("930f"),l("b3f2"));const J=l.n(F)()(A,[["render",function(e,t,l,c,U,$){const A=Object(i.resolveComponent)("el-tree"),F=Object(i.resolveComponent)("el-button"),J=Object(i.resolveComponent)("el-upload"),K=Object(i.resolveComponent)("el-input"),M=Object(i.resolveComponent)("el-empty"),R=Object(i.resolveComponent)("el-progress"),G=Object(i.resolveComponent)("el-image"),H=Object(i.resolveComponent)("el-scrollbar"),Q=Object(i.resolveComponent)("el-pagination"),W=Object(i.resolveComponent)("el-dialog"),X=Object(i.resolveDirective)("loading");return Object(i.openBlock)(),Object(i.createElementBlock)("div",o,[Object(i.withDirectives)(Object(i.createElementVNode)("div",a,[Object(i.createElementVNode)("div",s,[Object(i.createVNode)(A,{ref:"group",class:"menu",data:U.menu,"node-key":U.treeProps.key,props:U.treeProps,"current-node-key":U.menu.length>0?U.menu[0][U.treeProps.key]:"","highlight-current":"",onNodeClick:$.groupClick},{default:Object(i.withCtx)(({node:e})=>[Object(i.createElementVNode)("span",r,[n,Object(i.createTextVNode)(Object(i.toDisplayString)(e.label),1)])]),_:1},8,["data","node-key","props","current-node-key","onNodeClick"])]),l.multiple?(Object(i.openBlock)(),Object(i.createElementBlock)("div",d,[u,Object(i.createElementVNode)("b",null,Object(i.toDisplayString)(U.value.length),1),p,Object(i.createElementVNode)("b",null,Object(i.toDisplayString)(l.max),1),m])):Object(i.createCommentVNode)("",!0)],512),[[X,U.menuLoading]]),Object(i.withDirectives)(Object(i.createElementVNode)("div",b,[Object(i.createElementVNode)("div",f,[l.hideUpload?Object(i.createCommentVNode)("",!0):(Object(i.openBlock)(),Object(i.createElementBlock)("div",g,[Object(i.createVNode)(J,{class:"zy-file-select__upload",action:"",multiple:"","show-file-list":!1,accept:U.accept,"on-change":$.uploadChange,"before-upload":$.uploadBefore,"on-progress":$.uploadProcess,"on-success":$.uploadSuccess,"on-error":$.uploadError,"http-request":$.uploadRequest},{default:Object(i.withCtx)(()=>[Object(i.createVNode)(F,{type:"primary",icon:"el-icon-upload2"},{default:Object(i.withCtx)(()=>[O]),_:1})]),_:1},8,["accept","on-change","before-upload","on-progress","on-success","on-error","http-request"]),Object(i.createElementVNode)("span",j,[h,Object(i.createTextVNode)("大小不超过"+Object(i.toDisplayString)(l.maxSize)+"MB",1)])])),Object(i.createElementVNode)("div",y,[Object(i.createVNode)(K,{modelValue:U.keyword,"onUpdate:modelValue":t[0]||(t[0]=e=>U.keyword=e),"prefix-icon":"el-icon-search",placeholder:"文件名搜索",clearable:"",onKeyup:Object(i.withKeys)($.search,["enter"]),onClear:$.search},null,8,["modelValue","onKeyup","onClear"])])]),Object(i.createElementVNode)("div",k,[Object(i.createVNode)(H,{ref:"scrollbar"},{default:Object(i.withCtx)(()=>[0==U.fileList.length&&0==U.data.length?(Object(i.openBlock)(),Object(i.createBlock)(M,{key:0,description:"无数据","image-size":80})):Object(i.createCommentVNode)("",!0),(Object(i.openBlock)(!0),Object(i.createElementBlock)(i.Fragment,null,Object(i.renderList)(U.fileList,(e,t)=>(Object(i.openBlock)(),Object(i.createElementBlock)("div",{key:t,class:"zy-file-select__item"},[Object(i.createElementVNode)("div",v,[Object(i.createElementVNode)("div",N,[Object(i.createVNode)(R,{type:"circle",percentage:e.progress,width:70},null,8,["percentage"])]),Object(i.createVNode)(G,{src:e.tempImg,fit:"contain"},null,8,["src"])]),Object(i.createElementVNode)("p",null,Object(i.toDisplayString)(e.name),1)]))),128)),(Object(i.openBlock)(!0),Object(i.createElementBlock)(i.Fragment,null,Object(i.renderList)(U.data,e=>(Object(i.openBlock)(),Object(i.createElementBlock)("div",{key:e[U.fileProps.url],class:Object(i.normalizeClass)(["zy-file-select__item",{active:U.value.includes(e[U.fileProps.url])}]),onClick:t=>$.fnSelect(e)},[Object(i.createElementVNode)("div",V,[l.multiple?(Object(i.openBlock)(),Object(i.createElementBlock)("div",z,C)):(Object(i.openBlock)(),Object(i.createElementBlock)("div",w,x)),E,Object(i.createElementVNode)("div",{class:"zy-preview-src",onClick:Object(i.withModifiers)(t=>$.fnPreview(e),["stop"])},B,8,P),$._isImg(e[U.fileProps.url])?(Object(i.openBlock)(),Object(i.createBlock)(G,{key:2,src:e[U.fileProps.url],fit:"contain",lazy:""},null,8,["src"])):(Object(i.openBlock)(),Object(i.createElementBlock)("div",S,[U.files[$._getExt(e[U.fileProps.url])]?(Object(i.openBlock)(),Object(i.createElementBlock)("i",{key:0,class:Object(i.normalizeClass)(U.files[$._getExt(e[U.fileProps.url])].icon),style:Object(i.normalizeStyle)({color:U.files[$._getExt(e[U.fileProps.url])].color})},null,6)):(Object(i.openBlock)(),Object(i.createElementBlock)("i",I))]))]),Object(i.createElementVNode)("p",{title:e[U.fileProps.fileName]},Object(i.toDisplayString)(e[U.fileProps.fileName]),9,D)],10,_))),128))]),_:1},512)]),Object(i.createElementVNode)("div",L,[Object(i.createVNode)(Q,{small:"",background:"",layout:"prev, pager, next",total:U.total,"page-size":U.pageSize,currentPage:U.currentPage,"onUpdate:currentPage":t[1]||(t[1]=e=>U.currentPage=e),onCurrentChange:$.reload},null,8,["total","page-size","currentPage","onCurrentChange"])]),Object(i.createElementVNode)("div",q,[Object(i.renderSlot)(e.$slots,"do",{},void 0,!0),Object(i.createVNode)(F,{type:"primary",disabled:U.value.length<=0,onClick:$.submit},{default:Object(i.withCtx)(()=>[T]),_:1},8,["disabled","onClick"])]),Object(i.createVNode)(W,{width:"600px",center:"",modelValue:U.dialogImgVisible,"onUpdate:modelValue":t[2]||(t[2]=e=>U.dialogImgVisible=e),title:U.listImgData.fileName},{default:Object(i.withCtx)(()=>[Object(i.createVNode)(G,{src:U.listImgData.url,fit:"contain",class:"preview_img",lazy:""},null,8,["src"])]),_:1},8,["modelValue","title"])],512),[[X,U.listLoading]])])}],["__scopeId","data-v-4872df40"]]);t.default=J},d92d:function(e,t,l){}}]);